import{$a as u,$b as A,Ab as T,Bb as R,Cb as U,Db as H,Eb as y,Ia as j,Ib as o,Jb as _,Kb as h,Ma as r,Sb as E,T as V,Tb as S,Y as s,ba as v,ca as g,da as N,jb as O,kb as q,mc as z,nb as B,nc as G,ob as L,pb as C,qb as d,rb as p,sb as D,sc as J,tb as m,tc as K,ub as l,vb as Q,vc as W,wb as $,wc as f,xb as b,xc as X,yb as F,zb as x}from"./chunk-7UFJX7QR.js";var ee=["inputQuantity"];function te(n,i){if(n&1&&(m(0,"span",16),o(1),E(2,"currency"),l(),m(3,"span",17),o(4),E(5,"currency"),l()),n&2){let e=T();r(),h(" ",S(2,2,e.item().price)," "),r(3),h(" ",S(5,4,e.item().finalPrice)," ")}}function ie(n,i){if(n&1&&(m(0,"span",7),o(1),E(2,"currency"),l()),n&2){let e=T();r(),h(" ",S(2,1,e.item().price)," ")}}var w=class n{item=A.required();cartService=s(f);inputQuantity;onRemoveItem(i){this.cartService.removeFromCart(i)}onQuantityChange(i,e){let t=parseInt(e),a=this.item().stock;isNaN(t)||t<1?t=1:t>a&&(t=a),this.inputQuantity&&this.inputQuantity.nativeElement&&(this.inputQuantity.nativeElement.value=t.toString()),this.cartService.updateQuantity(i,t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-cart-item"]],viewQuery:function(e,t){if(e&1&&R(ee,5),e&2){let a;U(a=H())&&(t.inputQuantity=a.first)}},inputs:{item:[1,"item"]},decls:22,vars:8,consts:[["inputQuantity",""],[1,"bg-white","border","border-slate-100","rounded-2xl","p-4","flex","gap-4","items-center","transition-all","hover:shadow-md"],[1,"w-20","h-20","bg-slate-50","rounded-xl","flex-shrink-0","border","border-slate-100"],[1,"w-full","h-full","object-contain","p-2",3,"src","alt"],[1,"flex","flex-col","flex-1","min-w-0"],[1,"text-sm","font-bold","text-slate-900","truncate"],[1,"mt-1","flex","flex-col"],[1,"text-base","font-black","text-slate-900"],[1,"flex","flex-col","items-center","gap-1"],[1,"text-[9px]","font-bold","uppercase","text-slate-400","tracking-wider"],[1,"flex","items-center","bg-slate-50","border","border-slate-200","rounded-lg","p-1"],["type","button",1,"w-7","h-7","flex","items-center","justify-center","bg-white","rounded-md","shadow-sm","disabled:opacity-30","disabled:cursor-not-allowed","active:scale-90","transition-all","text-slate-600","font-bold",3,"click","disabled"],["type","number","min","1","readonly","",1,"w-8","text-center","bg-transparent","border-none","text-sm","font-bold","text-slate-800","focus:ring-0","cursor-default",3,"change","max","value"],["title","Eliminar producto",1,"ml-2","p-2","text-slate-300","hover:text-red-500","transition-colors","cursor-pointer","group",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-[10px]","text-slate-400","line-through"],[1,"text-base","font-black","text-blue-600"]],template:function(e,t){if(e&1){let a=$();m(0,"div",1)(1,"div",2),Q(2,"img",3),l(),m(3,"div",4)(4,"span",5),o(5),l(),m(6,"div",6),O(7,te,6,6)(8,ie,3,3,"span",7),l()(),m(9,"div",8)(10,"span",9),o(11,"Cantidad"),l(),m(12,"div",10)(13,"button",11),x("click",function(){v(a);let c=y(16);return c.value=(+c.value-1).toString(),g(t.onQuantityChange(t.item().id,c.value))}),o(14," - "),l(),m(15,"input",12,0),x("change",function(){v(a);let c=y(16);return g(t.onQuantityChange(t.item().id,c.value))}),l(),m(17,"button",11),x("click",function(){v(a);let c=y(16);return c.value=(+c.value+1).toString(),g(t.onQuantityChange(t.item().id,c.value))}),o(18," + "),l()()(),m(19,"button",13),x("click",function(){return v(a),g(t.onRemoveItem(t.item().id))}),N(),m(20,"svg",14),Q(21,"path",15),l()()()}if(e&2){let a=y(16);r(2),b("src",t.item().image,j)("alt",t.item().title),r(3),_(t.item().title),r(2),q(t.item().discountPercentage>0?7:8),r(6),b("disabled",+a.value<=1),r(2),b("max",t.item().stock)("value",t.item().quantity),r(2),b("disabled",+a.value>=t.item().stock)}},dependencies:[G,z],encapsulation:2,changeDetection:0})};var k=class n{_apiUrl=`${X.serverUrl}/api/MercadoPago`;_http=s(K);createPreference(i){return this._http.post(`${this._apiUrl}/create-preference`,i)}confirmPayment(i,e){let t=new J({"Content-Type":"application/json"});return this._http.post(`${this._apiUrl}/confirm-payment`,{preferenceId:i,paymentId:e},{headers:t})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=V({token:n,factory:n.\u0275fac,providedIn:"root"})};var I=class n{cartService=s(f);total=this.cartService.totalPrice;_mercadoPagoService=s(k);onCheckout(){let i={items:this.cartService.cart().map(e=>({name:e.title,quantity:e.quantity,price:e.finalPrice?e.finalPrice:e.price}))};this._mercadoPagoService.createPreference(i).subscribe({next:e=>{let t=e.sandbox_init_point||e.init_point;!t&&e.id&&(t=`https://sandbox.mercadopago.com.ar/checkout/v1/redirect?pref_id=${e.id}`,console.warn("Backend no devolvi\xF3 sandbox_init_point, usando URL construida manualmente:",t)),t?window.location.href=t:(console.error("Error: No se recibi\xF3 link ni ID de preferencia.",e),alert("Error: No se pudo generar el link de pago."))},error:e=>console.error("Error en API:",e)})}isDisabled(){return this.cartService.cart().length===0}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-order-summary"]],decls:10,vars:2,consts:[[1,"bg-slate-100","border","border-slate-200","rounded-xl","p-6","shadow-xl"],[1,"text-2xl"],[1,"flex","flex-col","gap-4"],[1,"flex","gap-4","mt-2"],[1,"text-lg"],[1,"text-lg","font-bold"],["label","Proceder al pago",3,"click","disabled"]],template:function(e,t){e&1&&(d(0,"div",0)(1,"h2",1),o(2,"Total del pedido"),p(),d(3,"div",2)(4,"div",3)(5,"span",4),o(6,"Total"),p(),d(7,"span",5),o(8),p()(),d(9,"app-primary-button",6),F("click",function(){return t.onCheckout()}),p()()()),e&2&&(r(8),_("$"+t.total()),r(),C("disabled",t.isDisabled()))},dependencies:[W],encapsulation:2,changeDetection:0})};var ne=(n,i)=>i.id;function re(n,i){if(n&1&&D(0,"app-cart-item",2),n&2){let e=i.$implicit;C("item",e)}}var Z=class n{cartService=s(f);static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-cart"]],decls:6,vars:0,consts:[[1,"p-6","flex","flex-col","gap-4","max-w-full","lg:max-w-4xl","mx-auto"],[1,"text-2xl"],[3,"item"]],template:function(e,t){e&1&&(d(0,"div",0)(1,"h2",1),o(2,"Shopping Cart"),p(),B(3,re,1,1,"app-cart-item",2,ne),D(5,"app-order-summary"),p()),e&2&&(r(3),L(t.cartService.cart()))},dependencies:[w,I],encapsulation:2})};export{Z as Cart};
