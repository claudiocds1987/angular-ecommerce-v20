import{$a as h,Da as s,Fb as q,Lb as $,M as I,Mb as F,Ob as U,Pb as u,Qb as V,R as o,Ra as w,Sa as D,Ta as k,Ua as p,Va as c,W as x,Wa as S,X as C,Xa as l,Ya as d,Za as M,_a as T,cb as N,db as E,ib as j,lb as a,mb as f,pa as P,ra as m,rb as O}from"./chunk-W6CN4E7T.js";var v=class i{item=q.required();cartService=o(u);onRemoveItem(r){this.cartService.removeFromCart(r)}onQuantityChange(r,e){let t=parseInt(e),n=this.item().rating.count;isNaN(t)||t<1?t=1:t>n&&(t=n);let g=document.querySelector('input[type="number"]');g&&(g.value=t.toString()),this.cartService.updateQuantity(r,t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=s({type:i,selectors:[["app-cart-item"]],inputs:{item:[1,"item"]},decls:15,vars:6,consts:[["quantityInput",""],[1,"bg-white","border","border-slate-200","rounded-xl","p-6","flex","gap-4","items-center"],[1,"w-[100px]","h-[100px]","object-contain",3,"src","alt"],[1,"flex","flex-col","gap-2","flex-1"],[1,"text-md","font-bold"],[1,"text-sm"],["type","number","min","1","value","1",1,"w-16","border","border-slate-300","rounded-md","px-2","py-1",3,"change","max"],[1,"flex","justify-end"],[1,"text-black","px-5","py-2","rounded-xl","shadow-md","cursor-pointer","bg-gray-100","hover:bg-gray-200","transition-colors",3,"click"]],template:function(e,t){if(e&1){let n=T();l(0,"div",1),M(1,"img",2),l(2,"div",3)(3,"span",4),a(4),d(),l(5,"span",5),a(6),d()(),l(7,"div")(8,"span"),a(9,"Cantidad: "),d(),l(10,"input",6,0),E("change",function(){x(n);let Q=j(11);return C(t.onQuantityChange(t.item().id,Q.value))}),d()(),l(12,"div",7)(13,"button",8),E("click",function(){return x(n),C(t.onRemoveItem(t.item().id))}),a(14," Eliminar "),d()()()}e&2&&(m(),h("alt",O(t.item().title))("src",t.item().image,P),m(3),f(t.item().title),m(2),f("$"+t.item().price),m(4),h("max",t.item().rating.count))},encapsulation:2})};var y=class i{_apiUrl=`${V.serverUrl}/api/MercadoPago`;_http=o(F);createPreference(r){return this._http.post(`${this._apiUrl}/create-preference`,r)}confirmPayment(r,e){let t=new $({"Content-Type":"application/json"});return this._http.post(`${this._apiUrl}/confirm-payment`,{preferenceId:r,paymentId:e},{headers:t})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=I({token:i,factory:i.\u0275fac,providedIn:"root"})};var b=class i{cartService=o(u);total=this.cartService.totalPrice;_mercadoPagoService=o(y);onCheckout(){let r={items:this.cartService.cart().map(e=>({name:e.title,quantity:e.quantity,price:e.price}))};this._mercadoPagoService.createPreference(r).subscribe({next:e=>{console.log("ID recibido:",e.id);let t=window.MercadoPago;if(t)try{new t("TEST-c3a31b76-ad93-4877-b3a9-fdefa8357b42").checkout({preference:{id:e.id},autoOpen:!0})}catch(n){console.error("Error al instanciar MP:",n)}else alert("Error: No se encontr\xF3 la librer\xEDa de Mercado Pago.")},error:e=>console.error("Error en API:",e)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=s({type:i,selectors:[["app-order-summary"]],decls:10,vars:1,consts:[[1,"bg-slate-100","border","border-slate-200","rounded-xl","p-6","shadow-xl"],[1,"text-2xl"],[1,"flex","flex-col","gap-4"],[1,"flex","gap-4","mt-2"],[1,"text-lg"],[1,"text-lg","font-bold"],["label","Proceder al pago",3,"click"]],template:function(e,t){e&1&&(p(0,"div",0)(1,"h2",1),a(2,"Total del pedido"),c(),p(3,"div",2)(4,"div",3)(5,"span",4),a(6,"Total"),c(),p(7,"span",5),a(8),c()(),p(9,"app-primary-button",6),N("click",function(){return t.onCheckout()}),c()()()),e&2&&(m(8),f("$"+t.total()))},dependencies:[U],encapsulation:2})};var B=(i,r)=>r.id;function R(i,r){if(i&1&&S(0,"app-cart-item",2),i&2){let e=r.$implicit;k("item",e)}}var L=class i{cartService=o(u);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=s({type:i,selectors:[["app-cart"]],decls:6,vars:0,consts:[[1,"p-6","flex","flex-col","gap-4","max-w-full","lg:max-w-4xl","mx-auto"],[1,"text-2xl"],[3,"item"]],template:function(e,t){e&1&&(p(0,"div",0)(1,"h2",1),a(2,"Shopping Cart"),c(),w(3,R,1,1,"app-cart-item",2,B),S(5,"app-order-summary"),c()),e&2&&(m(3),D(t.cartService.cart()))},dependencies:[v,b],encapsulation:2})};export{L as Cart};
