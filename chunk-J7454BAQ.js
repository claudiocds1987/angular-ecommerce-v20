import{$a as a,Aa as s,K as _,La as D,Ma as k,Na as T,O as P,Oa as c,P as m,Pa as o,Qa as S,Ra as p,Sa as d,Ta as M,U as x,Ua as N,V as C,Va as h,Wa as O,Xa as E,Za as j,ab as f,cb as q,ib as F,ma as w,oa as n,ob as $,qb as H,rb as u}from"./chunk-DIGWARWK.js";var v=class i{item=F.required();cartService=m(u);onRemoveItem(r){this.cartService.removeFromCart(r)}onQuantityChange(r,t){let e=parseInt(t),l=this.item().rating.count;isNaN(e)||e<1?e=1:e>l&&(e=l);let g=document.querySelector('input[type="number"]');g&&(g.value=e.toString()),this.cartService.updateQuantity(r,e)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=s({type:i,selectors:[["app-cart-item"]],inputs:{item:[1,"item"]},decls:15,vars:6,consts:[["quantityInput",""],[1,"bg-white","border","border-slate-200","rounded-xl","p-6","flex","gap-4","items-center"],[1,"w-[100px]","h-[100px]","object-contain",3,"src","alt"],[1,"flex","flex-col","gap-2","flex-1"],[1,"text-md","font-bold"],[1,"text-sm"],["type","number","min","1","value","1",1,"w-16","border","border-slate-300","rounded-md","px-2","py-1",3,"change","max"],[1,"flex","justify-end"],[1,"text-black","px-5","py-2","rounded-xl","shadow-md","cursor-pointer","bg-gray-100","hover:bg-gray-200","transition-colors",3,"click"]],template:function(t,e){if(t&1){let l=N();p(0,"div",1),M(1,"img",2),p(2,"div",3)(3,"span",4),a(4),d(),p(5,"span",5),a(6),d()(),p(7,"div")(8,"span"),a(9,"Cantidad: "),d(),p(10,"input",6,0),E("change",function(){x(l);let L=j(11);return C(e.onQuantityChange(e.item().id,L.value))}),d()(),p(12,"div",7)(13,"button",8),E("click",function(){return x(l),C(e.onRemoveItem(e.item().id))}),a(14," Eliminar "),d()()()}t&2&&(n(),h("alt",q(e.item().title))("src",e.item().image,w),n(3),f(e.item().title),n(2),f("$"+e.item().price),n(4),h("max",e.item().rating.count))},encapsulation:2})};var b=class i{constructor(r){this.http=r}apiUrl="https://localhost:44364/api/MercadoPago";createPreference(r){return this.http.post(`${this.apiUrl}/create-preference`,r)}confirmPayment(r,t){return this.http.post(`${this.apiUrl}/confirm-payment`,{preferenceId:r,paymentId:t})}static \u0275fac=function(t){return new(t||i)(P($))};static \u0275prov=_({token:i,factory:i.\u0275fac,providedIn:"root"})};var y=class i{cartService=m(u);total=this.cartService.totalPrice;_mercadoPagoService=m(b);onCheckout(){let r=new MercadoPago("TEST-c3a31b76-ad93-4877-b3a9-fdefa8357b42"),t={items:this.cartService.cart().map(e=>({name:e.title,quantity:e.quantity,price:e.price}))};console.log("Datos para backend:",t),this._mercadoPagoService.createPreference(t).subscribe({next:e=>{console.log("Preference ID recibido:",e.id),r.checkout({preference:{id:e.id},autoOpen:!0})},error:e=>{console.error("Error al crear la preferencia",e),alert("Hubo un error al procesar el pago")}})}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=s({type:i,selectors:[["app-order-summary"]],decls:10,vars:1,consts:[[1,"bg-slate-100","border","border-slate-200","rounded-xl","p-6","shadow-xl"],[1,"text-2xl"],[1,"flex","flex-col","gap-4"],[1,"flex","gap-4","mt-2"],[1,"text-lg"],[1,"text-lg","font-bold"],["label","Proceder al pago",3,"click"]],template:function(t,e){t&1&&(c(0,"div",0)(1,"h2",1),a(2,"Total del pedido"),o(),c(3,"div",2)(4,"div",3)(5,"span",4),a(6,"Total"),o(),c(7,"span",5),a(8),o()(),c(9,"app-primary-button",6),O("click",function(){return e.onCheckout()}),o()()()),t&2&&(n(8),f("$"+e.total()))},dependencies:[H],encapsulation:2})};var Q=(i,r)=>r.id;function B(i,r){if(i&1&&S(0,"app-cart-item",2),i&2){let t=r.$implicit;T("item",t)}}var U=class i{cartService=m(u);static \u0275fac=function(t){return new(t||i)};static \u0275cmp=s({type:i,selectors:[["app-cart"]],decls:6,vars:0,consts:[[1,"p-6","flex","flex-col","gap-4","max-w-full","lg:max-w-4xl","mx-auto"],[1,"text-2xl"],[3,"item"]],template:function(t,e){t&1&&(c(0,"div",0)(1,"h2",1),a(2,"Shopping Cart"),o(),D(3,B,1,1,"app-cart-item",2,Q),S(5,"app-order-summary"),o()),t&2&&(n(3),k(e.cartService.cart()))},dependencies:[v,y],encapsulation:2})};export{U as Cart};
